<link rel="stylesheet" href="../bolt/css/bolt.classes.css" />
<link rel="stylesheet" href="css/midi-graph.css" />

<style>
	html,
	body {
		margin: 0;
		padding: 0;
	}
</style>

<h1>MIDI Graph</h1>

<p>Open the console to see tests</p>

<!-- Sometime soon, we're going to replace this list with a canvas -->
<div class="midi-graph" id="midi-graph">
	<canvas class="midi_canvas" id="midi-canvas" width="1920" height="320"></canvas>
	
	<ul class="note_index inline_index index">
		 <li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li
		><li>G♯</li
		><li>A</li
		><li>B♭</li
		><li>B</li
		><li>C</li
		><li>C♯</li
		><li>D</li
		><li>E♭</li
		><li>E</li
		><li>F</li
		><li>F♯</li
		><li>G</li>
	</ul>
</div>


<script src="js/midi-graph.js"></script>
<script>

console.group('Testing MIDIGraph...');

(function() {
	var node = document.getElementById('midi-graph');

	var midiGraph = MIDIGraph({
		node: node
	});

	midiGraph.in({ data: [144,20,80] });
	midiGraph.in({ data: [144,40,0] });
	midiGraph.in({ data: [144,60,100] });
	midiGraph.in({ data: [144,80,100] });
	midiGraph.in({ data: [128,20,80] });

	// Colour test

//	midiGraph.in({ data: [144,40,127] });
//	midiGraph.in({ data: [145,41,122] });
//	midiGraph.in({ data: [146,42,123] });
//	midiGraph.in({ data: [147,43,127] });
//	midiGraph.in({ data: [148,44,121] });
//	midiGraph.in({ data: [149,45,124] });
//	midiGraph.in({ data: [150,46,123] });
//	midiGraph.in({ data: [151,47,125] });
//	midiGraph.in({ data: [152,48,122] });
//	midiGraph.in({ data: [153,49,126] });
//	midiGraph.in({ data: [154,50,127] });
//	midiGraph.in({ data: [155,51,121] });
//	midiGraph.in({ data: [156,52,120] });
//	midiGraph.in({ data: [157,53,124] });
//	midiGraph.in({ data: [158,54,122] });
//	midiGraph.in({ data: [159,55,122] });

	console.assert(node.querySelectorAll('.on').length === 2,
	              'There should be 2 notes active');

	setTimeout(function() {
		midiGraph.in({ data: [144,60,0] });
		midiGraph.in({ data: [148,60,80] });
		midiGraph.in({ data: [148,40,127] });
		midiGraph.in({ data: [152,20,80] });
	}, 500);

	setTimeout(function() {
		midiGraph.in({ data: [176,64,0] });
		midiGraph.in({ data: [176,67,2] });
		midiGraph.in({ data: [176,41,127] });
		midiGraph.in({ data: [176,64,80] });
	}, 1000);

	setTimeout(function() {
		midiGraph.in({ data: [176,67,70] });
		midiGraph.in({ data: [176,41,0] });
		midiGraph.in({ data: [176,64,0] });
		midiGraph.in({ data: [156,0,127] });
		midiGraph.in({ data: [156,127,127] });
	}, 1500);

	var l = 128,
	    n = -1;

	while (++n < l) {
		(function(n, p) {
			setTimeout(function() {
				midiGraph.in({ data: [p, n, 127] });
			}, parseInt(n * 20));

			setTimeout(function() {
				midiGraph.in({ data: [p - 16, n, 127] });
			}, parseInt(n * 20 + 300));
		})(n, 144 + (n % 16));
	}

	var l = 128,
	    n = -1;

	while (++n < l) {
		(function(n, p) {
			setTimeout(function() {
				midiGraph.in({ data: [p, n, 127] });
			}, parseInt(n * 40));

			setTimeout(function() {
				midiGraph.in({ data: [p, n, 0] });
			}, parseInt(n * 40 + 300));
		})(n, 176 + (n % 16));
	}


	navigator
	.requestMIDIAccess()
	.then(function(midi) {
		console.log('MIDI access available');
		midi.inputs().forEach(function(input) {
			input.addEventListener('midimessage', midiGraph.in);
			input.onmidimessage = function(e) {
				console.log(e);
			};
		});
	}, function(error) {
		console.log(error);
	});
})();

console.log('...tests complete');
console.groupEnd();
</script>















